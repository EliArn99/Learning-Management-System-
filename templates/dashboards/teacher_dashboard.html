{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—Å–∫–∏ Dashboard</h2>

    <!-- –ö–∞—Ä—Ç–∏ —Å—ä—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-white bg-primary shadow">
                <div class="card-body">
                    <h5 class="card-title">–û–±—â–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–∏—è</h5>
                    <p class="card-text display-6">{{ total_submissions }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-success shadow">
                <div class="card-body">
                    <h5 class="card-title">–û—Ü–µ–Ω–µ–Ω–∏ –ø—Ä–µ–¥–∞–≤–∞–Ω–∏—è</h5>
                    <p class="card-text display-6">{{ graded_submissions }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="card-title">–ë—ä—Ä–∑–∏ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                    <a href="{% url 'courses:create_course' %}" class="btn btn-sm btn-outline-primary mb-2">+ –ù–æ–≤ –∫—É—Ä—Å</a><br>
                    <a href="{% url 'assignments:create_assignment' %}" class="btn btn-sm btn-outline-success">+ –ù–æ–≤–æ –∑–∞–¥–∞–Ω–∏–µ</a>
                </div>
            </div>
        </div>
    </div>
<h4 class="mt-5">üìö –ö—É—Ä—Å–æ–≤–µ, –∫–æ–∏—Ç–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ</h4>
<div class="row">
    {% for course in courses %}
        <div class="col-md-6 mb-3">
            <div class="card border-info shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">{{ course.name }}</h5>
                    <p class="card-text">{{ course.description|truncatewords:20 }}</p>
                    <a href="{% url 'courses:course_detail' course.id %}" class="btn btn-sm btn-outline-info">–ü—Ä–µ–≥–ª–µ–¥</a>
                </div>
            </div>
        </div>
    {% empty %}
        <p>–ù—è–º–∞—Ç–µ —Å—ä–∑–¥–∞–¥–µ–Ω–∏ –∫—É—Ä—Å–æ–≤–µ.</p>
    {% endfor %}
</div>

<h4 class="mt-5">üïí –ù–∞–π-–∞–∫—Ç–∏–≤–Ω–∏ —Å—Ç—É–¥–µ–Ω—Ç–∏</h4>
<ul class="list-group">
    {% for student in active_students %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ student.user.username }}
            <span class="badge bg-secondary">{{ student.latest_submission_time|date:"d.m.Y H:i" }}</span>
        </li>
    {% empty %}
        <li class="list-group-item">–ù—è–º–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.</li>
    {% endfor %}
</ul>

<h4 class="mt-5">üë®‚Äçüéì –°—Ç—É–¥–µ–Ω—Ç–∏ –ø–æ –∫—É—Ä—Å–æ–≤–µ</h4>
<table class="table table-striped">
    <thead>
        <tr>
            <th>–ö—É—Ä—Å</th>
            <th>–ó–∞–ø–∏—Å–∞–Ω–∏ —Å—Ç—É–¥–µ–Ω—Ç–∏</th>
        </tr>
    </thead>
    <tbody>
        {% for course in courses %}
            <tr>
                <td>{{ course.name }}</td>
                <td>{{ course.enrollments.count }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="2">–ù—è–º–∞ –∫—É—Ä—Å–æ–≤–µ.</td></tr>
        {% endfor %}
    </tbody>
</table>


    <!-- –§–∏–ª—Ç—ä—Ä –ø–æ –∫—É—Ä—Å -->
    <form method="get" class="mb-3">
        <label for="course" class="form-label">–§–∏–ª—Ç—Ä–∏—Ä–∞–π –ø–æ –∫—É—Ä—Å:</label>
        <select name="course" id="course" class="form-select" onchange="this.form.submit()">
            <option value="">-- –í—Å–∏—á–∫–∏ –∫—É—Ä—Å–æ–≤–µ --</option>
            {% for course in courses %}
                <option value="{{ course.id }}" {% if course.id|stringformat:"s" == selected_course_id %}selected{% endif %}>
                    {{ course.name }}
                </option>
            {% endfor %}
        </select>
    </form>



    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏ –ø—Ä–µ–¥–∞–≤–∞–Ω–∏—è -->
    <h4 class="mt-4">üìÑ –ü–æ—Å–ª–µ–¥–Ω–∏ –ø—Ä–µ–¥–∞–≤–∞–Ω–∏—è</h4>
    <table class="table table-hover table-bordered mt-2">
        <thead class="table-light">
            <tr>
                <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                <th>–ó–∞–¥–∞–Ω–∏–µ</th>
                <th>–ö—É—Ä—Å</th>
                <th>–î–∞—Ç–∞</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
            </tr>
        </thead>
    
    
        <tbody>
            {% for sub in recent_submissions %}
                <tr>
                    <td>{{ sub.student.user.username }}</td>
                    <td>{{ sub.assignment.title }}</td>
                    <td>{{ sub.assignment.course.name }}</td>
                    <td>{{ sub.submitted_at|date:"d.m.Y H:i" }}</td>
                    <td>
                        {% if sub.grade %}
                            <span class="badge bg-success">–û—Ü–µ–Ω–µ–Ω–æ</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">–ß–∞–∫–∞ –æ—Ü–µ–Ω–∫–∞</span>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="5">–ù—è–º–∞ –ø—Ä–µ–¥–∞–≤–∞–Ω–∏—è.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
